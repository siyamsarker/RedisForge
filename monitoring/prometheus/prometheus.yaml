# ================================================================================
# RedisForge - Prometheus Configuration (Pull-Based Monitoring Reference)
# ================================================================================

# IMPORTANT:
# - This is a reference snippet to add to your existing Prometheus configuration.
# - RedisForge now relies on native Prometheus scraping (no Push Gateway).
# - Replace the placeholder IPs/hosts with your actual infrastructure details.

global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 30s
  external_labels:
    cluster: 'redisforge'
    environment: 'production'

scrape_configs:
  - job_name: 'redisforge-redis'
    metrics_path: /metrics
    static_configs:
      - targets:
          - '10.0.1.10:9121'
          - '10.0.2.11:9121'
          - '10.0.3.12:9121'
        labels:
          role: redis

  - job_name: 'redisforge-node'
    metrics_path: /metrics
    static_configs:
      - targets:
          - '10.0.1.10:9100'
          - '10.0.2.11:9100'
          - '10.0.3.12:9100'
        labels:
          role: system

  - job_name: 'redisforge-envoy'
    metrics_path: /stats/prometheus
    static_configs:
      - targets:
          - '<envoy-host>:9901'
        labels:
          role: envoy

  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

# ================================================================================
# KEY METRICS TO MONITOR
# ================================================================================
# Redis (job=redisforge-redis):
#   - redis_up, redis_cluster_slots_ok, redis_memory_used_bytes,
#     redis_connected_clients, redis_replication_lag_seconds
#
# Envoy (job=redisforge-envoy):
#   - envoy_cluster_membership_healthy, envoy_cluster_upstream_rq_total,
#     envoy_cluster_upstream_rq_time, envoy_cluster_upstream_cx_active
#
# Node (job=redisforge-node):
#   - node_cpu_seconds_total, node_memory_MemAvailable_bytes,
#     node_disk_io_time_seconds_total, node_network_receive_bytes_total
#
# ================================================================================
# EXAMPLE ALERTING RULES
# ================================================================================
# groups:
# - name: redis_alerts
#   rules:
#   - alert: RedisDown
#     expr: redis_up == 0
#     for: 1m
#     labels:
#       severity: critical
#   - alert: RedisMemoryHigh
#     expr: (redis_memory_used_bytes / redis_memory_max_bytes) > 0.9
#     for: 5m
#     labels:
#       severity: warning
#   - alert: RedisClusterUnhealthy
#     expr: redis_cluster_slots_ok < 16384
#     for: 2m
#     labels:
#       severity: critical
#   - alert: EnvoyHighErrorRate
#     expr: rate(envoy_cluster_upstream_rq{response_code_class="5"}[5m]) > 0.01
#     for: 5m
#     labels:
#       severity: warning
# ================================================================================
